<p align="center">
  <img width="100%" src="resources/construction.svg" title="Under Construction" />
</p>

# Graph Node

[The Graph](https://thegraph.com/) is a protocol for building decentralized applications quickly on Ethereum and IPFS using GraphQL.

Graph Node is an open source Rust implementation of the key backend infrastructure piece that sources blockchain events to deterministically update queryable datastores.

For detailed instructions and more context check out [Getting Started Guide](docs/getting-started.md).

## Quick Start

### Prerequisites

To build and run this project you need
to have the following installed on your system:

- Rust - [How to install Rust](https://www.rust-lang.org/en-US/install.html)
- PostgreSQL â€“ [PostgreSQL Downloads](https://www.postgresql.org/download/)
- IPFS â€“ [Installing IPFS](https://ipfs.io/docs/install/)

For Ethereum network data you can either run a local node or use Infura.io:

- Local node â€“ [Installing and running Ethereum node](https://ethereum.gitbooks.io/frontier-guide/content/getting_a_client.html)
- Infura infra â€“ [Infura.io](https://infura.io/)

### Running a local node

*Steps to set up Postgres*

1. Set up: `initdb -D .postgres` (somewhere; creates a Postgres config in `.postgres/`)
2. Start: `pg_ctl -D .postgres start` (or `postgres -D .postgres`?)
3. Create database: `createdb decentraland`
4. Delete database (whenever you want): `dropdb decentraland`
5. Log in to the database `psql decentraland`

*Start the Graph node*

1. Install IPFS and run `ipfs init` followed by `ipfs daemon`
2. Install and start Postgres and create a decentraland db with `createdb decentraland`
2. Clone https://github.com/graphprotocol/decentraland and build it with `yarn build-ipfs --verbosity debug` -> remember/copy the IPFS hash
3. Clone https://github.com/graphprotocol/graph-node and run `cargo build`

Once you have all the dependencies setup you can run the following:
```
cargo run -p graph-node -- \
  --postgres-url postgresql://localhost:5432/decentraland \
  --ethereum-ws wss://mainnet.infura.io/_ws \
  --ipfs 127.0.0.1:5001 \
  --subgraph IPFS_HASH
```

This will also spin up a GraphiQL interface at `http://127.0.0.1:8000/`.

### Command-line interface

```
USAGE:
    graph-node
      --subgraph <IPFS_HASH>
      --ethereum-ipc <FILE>
        or --ethereum-rpc <URL>
        or --ethereum-ws <URL>
      --ipfs <HOST:PORT>
      --postgres-url <URL>

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
        --subgraph <IPFS_HASH>       IPFS hash of the subgraph manifest
        --ethereum-ipc <FILE>        Ethereum IPC pipe
        --ethereum-rpc <URL>         Ethereum RPC endpoint
        --ethereum-ws <URL>          Ethereum WebSocket endpoint
        --ipfs <HOST:PORT>           HTTP address of an IPFS node
        --postgres-url <URL>         Location of the Postgres database used for storing entities
```

### Environment Variables

The Graph supports the following environment variables:

```
THEGRAPH_SENTRY_URL (optional) â€” Activates error reporting using Sentry
```

## Project Layout

- `node` â€” A local Graph node.
- `graph` â€” A library providing traits for system components and types for
  common data.
- `core` â€” A library providing implementations for core components, used by all
  nodes.
- `datasource/ethereum` â€” A library with components for obtaining data from
  Ethereum.
- `graphql` â€” A GraphQL implementation with API schema generation,
  introspection and more.
- `mock` â€” A library providing mock implementations for all system components.
- `runtime/wasm` â€” A library for running WASM data extraction scripts.
- `server/http` â€” A library providing a GraphQL server over HTTP.
- `store/postgres` â€” A Postgres store with a GraphQL friendly interface
  and audit logs.

## Roadmap

ðŸ”¨ = In Progress

ðŸ›  = Feature complete. Additional testing required.

âœ… = Feature complete


| Feature |  Status |
| ------- |  :------: |
| **Ethereum** |    |
| Indexing Smart Contract Events | âœ… |
| Handle chain reorganizations | ðŸ›  |
| **Mappings** |    |
| WASM-based mappings| âœ… |
| TypeScript-to-WASM toolchain | âœ… |
| Autogenerated TypeScript types | âœ… |
| **GraphQL** |     |
| Query entities by ID | âœ… |
| Query entity collections | âœ… |
| Pagination | âœ… |
| Filtering | âœ… |
| Entity relationships | âœ… |
| Subscriptions | ðŸ”¨|


## Contributing

Please check [CONTRIBUTING.md](CONTRIBUTING.md) for development flow and conventions we use.

## License

Copyright &copy; 2018 Graph Protocol, Inc. and contributors.

The Graph is dual-licensed under the [MIT license](LICENSE-MIT) and the
[Apache License, Version 2.0](LICENSE-APACHE).
