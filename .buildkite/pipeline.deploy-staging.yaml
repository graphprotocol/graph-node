steps:
  - label: Build and push Docker image
    command: |
      cp resources/docker/thegraph-standalone-node/Dockerfile . \
      && gcloud container builds submit \
         --timeout=25m \
         --tag gcr.io/the-graph-staging/thegraph-standalone-node .
  - wait
  - label: Deploy the standalone node
    command: |
      kubectl apply \
         --cluster=$BUILDKITE_TARGET_CLUSTER \
         --user=$BUILDKITE_TARGET_CLUSTER \
         -f resources/kubernetes/thegraph-standalone-node/deployment.yaml \
      && kubectl apply \
         --cluster=$BUILDKITE_TARGET_CLUSTER \
         --user=$BUILDKITE_TARGET_CLUSTER \
         -f resources/kubernetes/thegraph-standalone-node/service.yaml \
